<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè∫ Pomodoro Timer - Reloj de Arena | Jorge Luis Risso Patr√≥n</title>
    <meta name="description" content="Pomodoro Timer minimalista con reloj de arena virtual. Dise√±o enfocado en concentraci√≥n y productividad.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚è≥</text></svg>">
    
    <style>
        /* ==================== Variables CSS para Concentraci√≥n ==================== */
        :root {
            /* Fondo minimalista neutro */
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --bg-subtle: #e9ecef;
            
            /* Colores de concentraci√≥n - Azules y verdes calmantes */
            --focus-blue: #4a90e2;
            --focus-blue-light: #74a9e8;
            --focus-green: #2ecc71;
            --focus-green-light: #58d68d;
            
            /* Arena dorada para trabajo */
            --sand-work: #f4d03f;
            --sand-work-dark: #f1c40f;
            --sand-work-light: #f7dc6f;
            
            /* Arena azul plateada para descanso */
            --sand-break: #85c1e9;
            --sand-break-dark: #5dade2;
            --sand-break-light: #a9cce3;
            
            /* Neutros calmantes */
            --text-primary: #2c3e50;
            --text-secondary: #5d6d7e;
            --text-muted: #85929e;
            
            /* Cristal del reloj de arena */
            --glass: rgba(255, 255, 255, 0.9);
            --glass-border: rgba(0, 0, 0, 0.1);
            
            /* Sombras suaves */
            --shadow-soft: rgba(0, 0, 0, 0.08);
            --shadow-medium: rgba(0, 0, 0, 0.12);
        }

        /* ==================== Reset y Base Minimalista ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ==================== Header Minimalista ==================== */
        .header {
            background: var(--bg-secondary);
            padding: 2rem 1rem;
            text-align: center;
            border-bottom: 1px solid var(--bg-subtle);
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 300;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            letter-spacing: 0.5px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 400;
        }

        /* ==================== Container Principal ==================== */
        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        /* ==================== Reloj de Arena Virtual ==================== */
        .hourglass-container {
            position: relative;
            margin: 3rem 0;
            padding: 2rem;
        }

        .hourglass {
            width: 200px;
            height: 300px;
            position: relative;
            margin: 0 auto;
            filter: drop-shadow(0 20px 40px var(--shadow-soft));
        }

        /* Marco del reloj de arena */
        .hourglass-frame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--glass);
            border: 3px solid var(--glass-border);
            border-radius: 20px 20px 20px 20px;
            clip-path: polygon(
                20% 0%, 80% 0%, 80% 40%, 60% 50%, 80% 60%, 80% 100%, 20% 100%, 20% 60%, 40% 50%, 20% 40%
            );
            z-index: 10;
        }

        /* Compartimento superior */
        .sand-top {
            position: absolute;
            top: 10px;
            left: 20%;
            width: 60%;
            height: 35%;
            background: linear-gradient(180deg, 
                var(--sand-work-light) 0%, 
                var(--sand-work) 50%, 
                var(--sand-work-dark) 100%
            );
            border-radius: 15px 15px 0 0;
            overflow: hidden;
            transition: all 0.5s ease;
        }

        /* Compartimento inferior */
        .sand-bottom {
            position: absolute;
            bottom: 10px;
            left: 20%;
            width: 60%;
            height: 35%;
            background: transparent;
            border-radius: 0 0 15px 15px;
            overflow: hidden;
            position: relative;
        }

        /* Arena que se acumula abajo */
        .sand-accumulation {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            background: linear-gradient(0deg, 
                var(--sand-work-dark) 0%, 
                var(--sand-work) 50%, 
                var(--sand-work-light) 100%
            );
            transition: height 1s linear;
            border-radius: 0 0 12px 12px;
        }

        /* Flujo de arena en el centro */
        .sand-stream {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: 0px;
            background: linear-gradient(180deg, 
                var(--sand-work-light) 0%, 
                var(--sand-work) 50%, 
                var(--sand-work-dark) 100%
            );
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        /* Animaci√≥n de arena cayendo */
        .sand-stream.flowing {
            opacity: 1;
            height: 40px;
            animation: sandFlow 2s ease-in-out infinite;
        }

        @keyframes sandFlow {
            0%, 100% { 
                width: 2px; 
                opacity: 0.7; 
            }
            50% { 
                width: 4px; 
                opacity: 1; 
            }
        }

        /* Part√≠culas de arena */
        .sand-particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--sand-work);
            border-radius: 50%;
            pointer-events: none;
            animation: fallingSand 3s linear infinite;
        }

        @keyframes fallingSand {
            0% {
                top: 45%;
                opacity: 1;
                transform: translateX(-50%) scale(1);
            }
            100% {
                top: 85%;
                opacity: 0;
                transform: translateX(-50%) scale(0.5);
            }
        }

        /* ==================== Timer Display Minimalista ==================== */
        .timer-display {
            text-align: center;
            margin: 2rem 0;
        }

        .timer-time {
            font-size: 4rem;
            font-weight: 200;
            color: var(--text-primary);
            margin-bottom: 1rem;
            letter-spacing: 2px;
            font-variant-numeric: tabular-nums;
        }

        .timer-label {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-weight: 400;
            margin-bottom: 0.5rem;
        }

        .timer-session {
            font-size: 1rem;
            color: var(--text-muted);
            font-weight: 300;
        }

        /* ==================== Controles Minimalistas ==================== */
        .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin: 2rem 0;
        }

        .btn {
            background: var(--bg-secondary);
            border: 2px solid var(--bg-subtle);
            color: var(--text-primary);
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-width: 120px;
        }

        .btn:hover {
            border-color: var(--focus-blue);
            color: var(--focus-blue);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--shadow-medium);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: var(--focus-blue);
            border-color: var(--focus-blue);
            color: white;
        }

        .btn-primary:hover {
            background: var(--focus-blue-light);
            border-color: var(--focus-blue-light);
            color: white;
        }

        .btn-success {
            background: var(--focus-green);
            border-color: var(--focus-green);
            color: white;
        }

        .btn-success:hover {
            background: var(--focus-green-light);
            border-color: var(--focus-green-light);
            color: white;
        }

        /* ==================== Estados del Timer ==================== */
        
        /* Estado de trabajo */
        .app.work-mode {
            background: linear-gradient(135deg, 
                var(--bg-primary) 0%, 
                #fefefe 100%
            );
        }

        .app.work-mode .sand-top,
        .app.work-mode .sand-accumulation,
        .app.work-mode .sand-stream,
        .app.work-mode .sand-particle {
            background: linear-gradient(180deg, 
                var(--sand-work-light) 0%, 
                var(--sand-work) 50%, 
                var(--sand-work-dark) 100%
            );
        }

        /* Estado de descanso */
        .app.break-mode {
            background: linear-gradient(135deg, 
                #f0f8ff 0%, 
                var(--bg-primary) 100%
            );
        }

        .app.break-mode .sand-top,
        .app.break-mode .sand-accumulation,
        .app.break-mode .sand-stream,
        .app.break-mode .sand-particle {
            background: linear-gradient(180deg, 
                var(--sand-break-light) 0%, 
                var(--sand-break) 50%, 
                var(--sand-break-dark) 100%
            );
        }

        .app.break-mode .timer-time {
            color: var(--focus-blue);
        }

        /* ==================== Configuraciones ==================== */
        .settings {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 8px 32px var(--shadow-soft);
            width: 100%;
            max-width: 400px;
        }

        .settings h3 {
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            font-weight: 500;
            text-align: center;
        }

        .setting-group {
            margin-bottom: 1.5rem;
        }

        .setting-label {
            display: block;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .setting-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--bg-subtle);
            border-radius: 8px;
            font-size: 1rem;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: border-color 0.3s ease;
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--focus-blue);
        }

        /* ==================== Estad√≠sticas Minimalistas ==================== */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
            width: 100%;
            max-width: 400px;
        }

        .stat-item {
            background: var(--bg-secondary);
            padding: 1.5rem 1rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 16px var(--shadow-soft);
        }

        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: 300;
            color: var(--focus-blue);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* ==================== Animaci√≥n de Volteo ==================== */
        .hourglass.flipping {
            animation: flip 1s ease-in-out;
        }

        @keyframes flip {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg); }
        }

        /* ==================== Responsive ==================== */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .hourglass {
                width: 150px;
                height: 225px;
            }
            
            .timer-time {
                font-size: 3rem;
            }
            
            .controls {
                gap: 0.5rem;
            }
            
            .btn {
                padding: 0.75rem 1.5rem;
                min-width: 100px;
            }
        }

        /* ==================== Accesibilidad ==================== */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body class="app work-mode">
    <!-- Header Minimalista -->
    <header class="header">
        <h1>‚è≥ Pomodoro Timer</h1>
        <p>T√©cnica de concentraci√≥n con reloj de arena virtual</p>
    </header>

    <!-- Container Principal -->
    <main class="container">
        <!-- Reloj de Arena Virtual -->
        <div class="hourglass-container">
            <div class="hourglass" id="hourglass">
                <!-- Marco del reloj -->
                <div class="hourglass-frame"></div>
                
                <!-- Arena superior -->
                <div class="sand-top" id="sandTop"></div>
                
                <!-- Flujo de arena -->
                <div class="sand-stream" id="sandStream"></div>
                
                <!-- Arena inferior -->
                <div class="sand-bottom">
                    <div class="sand-accumulation" id="sandAccumulation"></div>
                </div>
            </div>
        </div>

        <!-- Display del Timer -->
        <div class="timer-display">
            <div class="timer-time" id="timerTime">25:00</div>
            <div class="timer-label" id="timerLabel">Sesi√≥n de Trabajo</div>
            <div class="timer-session" id="timerSession">Sesi√≥n 1 de 4</div>
        </div>

        <!-- Controles -->
        <div class="controls">
            <button class="btn btn-primary" id="startBtn">Iniciar</button>
            <button class="btn" id="pauseBtn">Pausar</button>
            <button class="btn" id="resetBtn">Reiniciar</button>
            <button class="btn" id="settingsBtn">Configurar</button>
        </div>

        <!-- Estad√≠sticas -->
        <div class="stats">
            <div class="stat-item">
                <span class="stat-number" id="completedSessions">0</span>
                <span class="stat-label">Sesiones</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="totalMinutes">0</span>
                <span class="stat-label">Minutos</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="currentStreak">0</span>
                <span class="stat-label">Racha</span>
            </div>
        </div>

        <!-- Configuraciones -->
        <div class="settings" id="settings" style="display: none;">
            <h3>‚öôÔ∏è Configuraci√≥n</h3>
            
            <div class="setting-group">
                <label class="setting-label" for="workDuration">Trabajo (minutos):</label>
                <input type="number" class="setting-input" id="workDuration" value="25" min="1" max="60">
            </div>
            
            <div class="setting-group">
                <label class="setting-label" for="shortBreakDuration">Descanso corto (minutos):</label>
                <input type="number" class="setting-input" id="shortBreakDuration" value="5" min="1" max="30">
            </div>
            
            <div class="setting-group">
                <label class="setting-label" for="longBreakDuration">Descanso largo (minutos):</label>
                <input type="number" class="setting-input" id="longBreakDuration" value="15" min="1" max="60">
            </div>
            
            <div class="controls">
                <button class="btn btn-success" id="saveSettingsBtn">Guardar</button>
                <button class="btn" id="cancelSettingsBtn">Cancelar</button>
            </div>
        </div>
    </main>

    <!-- Screen reader para accesibilidad -->
    <div class="sr-only" aria-live="polite" id="timerAnnouncement"></div>

    <script>
        // ==================== Variables del Timer ==================== 
        let timer = null;
        let timeLeft = 0;
        let isRunning = false;
        let currentMode = 'work'; // 'work', 'shortBreak', 'longBreak'
        let sessionCount = 0;
        let completedSessions = 0;
        let totalMinutes = 0;
        let currentStreak = 0;

        // Configuraciones por defecto
        let settings = {
            workDuration: 25,
            shortBreakDuration: 5,
            longBreakDuration: 15
        };

        // ==================== Elementos DOM ==================== 
        const elements = {
            timerTime: document.getElementById('timerTime'),
            timerLabel: document.getElementById('timerLabel'),
            timerSession: document.getElementById('timerSession'),
            startBtn: document.getElementById('startBtn'),
            pauseBtn: document.getElementById('pauseBtn'),
            resetBtn: document.getElementById('resetBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            settingsPanel: document.getElementById('settings'),
            saveSettingsBtn: document.getElementById('saveSettingsBtn'),
            cancelSettingsBtn: document.getElementById('cancelSettingsBtn'),
            completedSessionsEl: document.getElementById('completedSessions'),
            totalMinutesEl: document.getElementById('totalMinutes'),
            currentStreakEl: document.getElementById('currentStreak'),
            hourglass: document.getElementById('hourglass'),
            sandTop: document.getElementById('sandTop'),
            sandStream: document.getElementById('sandStream'),
            sandAccumulation: document.getElementById('sandAccumulation'),
            app: document.body,
            announcement: document.getElementById('timerAnnouncement')
        };

        // ==================== Funciones del Reloj de Arena ==================== 
        function createSandParticles() {
            const particles = document.querySelectorAll('.sand-particle');
            particles.forEach(p => p.remove());
            
            if (!isRunning) return;
            
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'sand-particle';
                    particle.style.left = `${48 + Math.random() * 4}%`;
                    elements.hourglass.appendChild(particle);
                    
                    setTimeout(() => particle.remove(), 3000);
                }, i * 200);
            }
        }

        function updateSandAnimation() {
            const totalTime = currentMode === 'work' ? settings.workDuration * 60 : 
                             currentMode === 'shortBreak' ? settings.shortBreakDuration * 60 :
                             settings.longBreakDuration * 60;
            
            const progress = (totalTime - timeLeft) / totalTime;
            
            // Actualizar arena superior (se vac√≠a)
            const topHeight = (1 - progress) * 100;
            elements.sandTop.style.height = `${Math.max(0, topHeight * 0.35)}%`;
            
            // Actualizar arena inferior (se llena)
            const bottomHeight = progress * 100;
            elements.sandAccumulation.style.height = `${Math.min(100, bottomHeight)}%`;
            
            // Mostrar/ocultar flujo de arena
            if (isRunning && topHeight > 5) {
                elements.sandStream.classList.add('flowing');
                createSandParticles();
            } else {
                elements.sandStream.classList.remove('flowing');
            }
        }

        function flipHourglass() {
            elements.hourglass.classList.add('flipping');
            setTimeout(() => {
                elements.hourglass.classList.remove('flipping');
                // Resetear arena despu√©s del volteo
                elements.sandTop.style.height = '35%';
                elements.sandAccumulation.style.height = '0%';
            }, 1000);
        }

        // ==================== Funciones del Timer ==================== 
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateDisplay() {
            elements.timerTime.textContent = formatTime(timeLeft);
            
            // Actualizar etiquetas seg√∫n el modo
            const labels = {
                work: 'Sesi√≥n de Trabajo',
                shortBreak: 'Descanso Corto',
                longBreak: 'Descanso Largo'
            };
            
            elements.timerLabel.textContent = labels[currentMode];
            elements.timerSession.textContent = `Sesi√≥n ${sessionCount + 1} de 4`;
            
            // Actualizar modo visual
            elements.app.className = `app ${currentMode === 'work' ? 'work-mode' : 'break-mode'}`;
            
            // Actualizar animaci√≥n de arena
            updateSandAnimation();
        }

        function updateStats() {
            elements.completedSessionsEl.textContent = completedSessions;
            elements.totalMinutesEl.textContent = totalMinutes;
            elements.currentStreakEl.textContent = currentStreak;
        }

        function playNotificationSound() {
            // Efecto de sonido sutil - arena cayendo
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Crear un sonido suave tipo "whoosh"
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.5);
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        function showNotification(message) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(message, {
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">‚è≥</text></svg>',
                    tag: 'pomodoro-timer'
                });
            }
            
            // Anuncio para lectores de pantalla
            elements.announcement.textContent = message;
        }

        function startTimer() {
            if (isRunning) return;
            
            isRunning = true;
            elements.startBtn.textContent = 'En marcha...';
            elements.startBtn.disabled = true;
            
            timer = setInterval(() => {
                timeLeft--;
                updateDisplay();
                
                if (timeLeft <= 0) {
                    completeSession();
                }
            }, 1000);
            
            updateDisplay();
        }

        function pauseTimer() {
            if (!isRunning) return;
            
            isRunning = false;
            clearInterval(timer);
            elements.startBtn.textContent = 'Continuar';
            elements.startBtn.disabled = false;
            
            // Pausar animaci√≥n de arena
            elements.sandStream.classList.remove('flowing');
        }

        function resetTimer() {
            isRunning = false;
            clearInterval(timer);
            
            // Resetear a modo trabajo
            currentMode = 'work';
            timeLeft = settings.workDuration * 60;
            
            elements.startBtn.textContent = 'Iniciar';
            elements.startBtn.disabled = false;
            
            updateDisplay();
        }

        function completeSession() {
            isRunning = false;
            clearInterval(timer);
            
            playNotificationSound();
            flipHourglass();
            
            if (currentMode === 'work') {
                completedSessions++;
                sessionCount = (sessionCount + 1) % 4;
                totalMinutes += settings.workDuration;
                currentStreak++;
                
                // Determinar tipo de descanso
                currentMode = sessionCount === 0 ? 'longBreak' : 'shortBreak';
                timeLeft = currentMode === 'longBreak' ? settings.longBreakDuration * 60 : settings.shortBreakDuration * 60;
                
                showNotification('üéâ ¬°Sesi√≥n de trabajo completada! Tiempo de descanso.');
            } else {
                // Completar descanso
                currentMode = 'work';
                timeLeft = settings.workDuration * 60;
                
                showNotification('‚ú® ¬°Descanso terminado! Hora de trabajar.');
            }
            
            elements.startBtn.textContent = 'Iniciar';
            elements.startBtn.disabled = false;
            
            updateDisplay();
            updateStats();
        }

        // ==================== Configuraciones ==================== 
        function showSettings() {
            elements.settingsPanel.style.display = 'block';
            
            // Cargar valores actuales
            document.getElementById('workDuration').value = settings.workDuration;
            document.getElementById('shortBreakDuration').value = settings.shortBreakDuration;
            document.getElementById('longBreakDuration').value = settings.longBreakDuration;
        }

        function hideSettings() {
            elements.settingsPanel.style.display = 'none';
        }

        function saveSettings() {
            settings.workDuration = parseInt(document.getElementById('workDuration').value);
            settings.shortBreakDuration = parseInt(document.getElementById('shortBreakDuration').value);
            settings.longBreakDuration = parseInt(document.getElementById('longBreakDuration').value);
            
            // Guardar en localStorage
            localStorage.setItem('pomodoroSettings', JSON.stringify(settings));
            
            // Resetear timer con nueva configuraci√≥n
            resetTimer();
            hideSettings();
        }

        function loadSettings() {
            const saved = localStorage.getItem('pomodoroSettings');
            if (saved) {
                settings = JSON.parse(saved);
            }
            
            const savedStats = localStorage.getItem('pomodoroStats');
            if (savedStats) {
                const stats = JSON.parse(savedStats);
                completedSessions = stats.completedSessions || 0;
                totalMinutes = stats.totalMinutes || 0;
                currentStreak = stats.currentStreak || 0;
            }
        }

        function saveStats() {
            const stats = {
                completedSessions,
                totalMinutes,
                currentStreak
            };
            localStorage.setItem('pomodoroStats', JSON.stringify(stats));
        }

        // ==================== Event Listeners ==================== 
        elements.startBtn.addEventListener('click', startTimer);
        elements.pauseBtn.addEventListener('click', pauseTimer);
        elements.resetBtn.addEventListener('click', resetTimer);
        elements.settingsBtn.addEventListener('click', showSettings);
        elements.saveSettingsBtn.addEventListener('click', saveSettings);
        elements.cancelSettingsBtn.addEventListener('click', hideSettings);

        // Pedir permisos de notificaci√≥n
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // Guardar estad√≠sticas autom√°ticamente
        window.addEventListener('beforeunload', saveStats);

        // Prevenir que la p√°gina se cierre accidentalmente durante sesi√≥n activa
        window.addEventListener('beforeunload', (e) => {
            if (isRunning) {
                e.preventDefault();
                e.returnValue = '¬øEst√°s seguro de que quieres salir? El timer se detendr√°.';
            }
        });

        // ==================== Inicializaci√≥n ==================== 
        loadSettings();
        timeLeft = settings.workDuration * 60;
        updateDisplay();
        updateStats();

        // Crear part√≠culas iniciales
        setTimeout(() => {
            elements.sandStream.classList.add('flowing');
            createSandParticles();
            setTimeout(() => {
                elements.sandStream.classList.remove('flowing');
            }, 2000);
        }, 1000);
    </script>
</body>
</html>