<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚òÄÔ∏è Pomodoro Timer - Reloj Solar | Jorge Luis Risso Patr√≥n</title>
    <meta name="description" content="Pomodoro Timer con reloj solar virtual. Dise√±o minimalista que simula el paso del tiempo con sombras y cielos cambiantes.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚òÄÔ∏è</text></svg>">
    
    <style>
        /* ==================== Variables CSS - Reloj Solar ==================== */
        :root {
            /* Cielos cambiantes seg√∫n el progreso */
            --dawn-sky: linear-gradient(180deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            --morning-sky: linear-gradient(180deg, #a18cd1 0%, #fbc2eb 100%);
            --midday-sky: linear-gradient(180deg, #74b9ff 0%, #0984e3 100%);
            --afternoon-sky: linear-gradient(180deg, #fd79a8 0%, #fdcb6e 100%);
            --evening-sky: linear-gradient(180deg, #6c5ce7 0%, #a29bfe 100%);
            --night-sky: linear-gradient(180deg, #2d3436 0%, #636e72 100%);
            
            /* Colores del reloj solar */
            --sundial-base: #8d6e63;
            --sundial-light: #a1887f;
            --sundial-shadow: rgba(0, 0, 0, 0.3);
            --gnomon: linear-gradient(135deg, #6d4c41 0%, #5d4037 100%);
            
            /* Sombra din√°mica */
            --shadow-work: rgba(139, 69, 19, 0.6);
            --shadow-break: rgba(30, 144, 255, 0.6);
            
            /* Neutrals para concentraci√≥n */
            --text-primary: #2c3e50;
            --text-secondary: #34495e;
            --text-muted: #7f8c8d;
            --bg-card: rgba(255, 255, 255, 0.9);
            --border-subtle: rgba(0, 0, 0, 0.1);
        }

        /* ==================== Reset y Base ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dawn-sky);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background 2s ease-in-out;
            position: relative;
            overflow-x: hidden;
        }

        /* Cielo de fondo din√°mico */
        body.dawn { background: var(--dawn-sky); }
        body.morning { background: var(--morning-sky); }
        body.midday { background: var(--midday-sky); }
        body.afternoon { background: var(--afternoon-sky); }
        body.evening { background: var(--evening-sky); }
        body.night { background: var(--night-sky); }

        /* Nubes sutiles flotantes */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 30%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 20%, rgba(255, 255, 255, 0.08) 0%, transparent 60%),
                radial-gradient(ellipse at 40% 80%, rgba(255, 255, 255, 0.12) 0%, transparent 45%);
            pointer-events: none;
            animation: driftClouds 30s ease-in-out infinite;
            z-index: 1;
        }

        @keyframes driftClouds {
            0%, 100% { 
                transform: translateX(0px);
                opacity: 0.3;
            }
            50% { 
                transform: translateX(50px);
                opacity: 0.6;
            }
        }

        /* ==================== Header Minimalista ==================== */
        .header {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            padding: 2rem 1rem;
            text-align: center;
            border-bottom: 1px solid var(--border-subtle);
            position: relative;
            z-index: 10;
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 300;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            letter-spacing: 0.5px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 400;
        }

        /* ==================== Container Principal ==================== */
        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            max-width: 700px;
            margin: 0 auto;
            width: 100%;
            position: relative;
            z-index: 10;
        }

        /* ==================== Reloj Solar Virtual ==================== */
        .sundial-container {
            position: relative;
            margin: 3rem 0;
            padding: 2rem;
        }

        .sundial {
            width: 300px;
            height: 300px;
            position: relative;
            margin: 0 auto;
            filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.15));
        }

        /* Base del reloj solar */
        .sundial-base {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 280px;
            height: 280px;
            background: 
                radial-gradient(circle at 30% 30%, var(--sundial-light) 0%, var(--sundial-base) 100%);
            border-radius: 50%;
            border: 8px solid var(--sundial-light);
            box-shadow: 
                inset 0 0 30px rgba(0, 0, 0, 0.1),
                0 8px 32px rgba(0, 0, 0, 0.2);
        }

        /* Marcas horarias del dial */
        .hour-markers {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 260px;
            height: 260px;
        }

        .hour-mark {
            position: absolute;
            width: 2px;
            height: 20px;
            background: var(--sundial-shadow);
            border-radius: 1px;
            transform-origin: center 130px;
        }

        .hour-mark:nth-child(1) { transform: rotate(0deg); top: 0; left: 50%; margin-left: -1px; }
        .hour-mark:nth-child(2) { transform: rotate(30deg); top: 0; left: 50%; margin-left: -1px; }
        .hour-mark:nth-child(3) { transform: rotate(60deg); top: 0; left: 50%; margin-left: -1px; }
        .hour-mark:nth-child(4) { transform: rotate(90deg); top: 0; left: 50%; margin-left: -1px; }
        .hour-mark:nth-child(5) { transform: rotate(120deg); top: 0; left: 50%; margin-left: -1px; }
        .hour-mark:nth-child(6) { transform: rotate(150deg); top: 0; left: 50%; margin-left: -1px; }
        .hour-mark:nth-child(7) { transform: rotate(180deg); top: 0; left: 50%; margin-left: -1px; }
        .hour-mark:nth-child(8) { transform: rotate(210deg); top: 0; left: 50%; margin-left: -1px; }
        .hour-mark:nth-child(9) { transform: rotate(240deg); top: 0; left: 50%; margin-left: -1px; }
        .hour-mark:nth-child(10) { transform: rotate(270deg); top: 0; left: 50%; margin-left: -1px; }
        .hour-mark:nth-child(11) { transform: rotate(300deg); top: 0; left: 50%; margin-left: -1px; }
        .hour-mark:nth-child(12) { transform: rotate(330deg); top: 0; left: 50%; margin-left: -1px; }

        /* Gnomon (el puntero central) */
        .gnomon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 6px;
            height: 80px;
            background: var(--gnomon);
            border-radius: 3px;
            transform-origin: center bottom;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            z-index: 15;
        }

        /* Sombra del gnomon */
        .gnomon-shadow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(0deg);
            width: 4px;
            height: 120px;
            background: linear-gradient(180deg, 
                transparent 0%, 
                var(--shadow-work) 30%, 
                var(--shadow-work) 100%
            );
            border-radius: 2px;
            transform-origin: center 40px;
            transition: transform 1s ease-out;
            opacity: 0.8;
            z-index: 5;
        }

        /* Estados de la sombra */
        .app.work-mode .gnomon-shadow {
            background: linear-gradient(180deg, 
                transparent 0%, 
                var(--shadow-work) 30%, 
                var(--shadow-work) 100%
            );
        }

        .app.break-mode .gnomon-shadow {
            background: linear-gradient(180deg, 
                transparent 0%, 
                var(--shadow-break) 30%, 
                var(--shadow-break) 100%
            );
        }

        /* Segmento de progreso */
        .progress-arc {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 260px;
            height: 260px;
            border-radius: 50%;
            border: 3px solid transparent;
            border-top-color: var(--shadow-work);
            opacity: 0.6;
            transition: transform 0.5s ease;
        }

        .app.break-mode .progress-arc {
            border-top-color: var(--shadow-break);
        }

        /* ==================== Timer Display ==================== */
        .timer-display {
            text-align: center;
            margin: 2rem 0;
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-subtle);
        }

        .timer-time {
            font-size: 4rem;
            font-weight: 200;
            color: var(--text-primary);
            margin-bottom: 1rem;
            letter-spacing: 2px;
            font-variant-numeric: tabular-nums;
        }

        .timer-label {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .timer-session {
            font-size: 1rem;
            color: var(--text-muted);
            font-weight: 400;
        }

        /* Indicador del tiempo del d√≠a */
        .day-time-indicator {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
            margin-top: 0.5rem;
            color: var(--text-secondary);
        }

        /* ==================== Controles Minimalistas ==================== */
        .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin: 2rem 0;
        }

        .btn {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border: 2px solid var(--border-subtle);
            color: var(--text-primary);
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-width: 120px;
        }

        .btn:hover {
            border-color: rgba(116, 185, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            border-color: #74b9ff;
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #81c3ff 0%, #2196f3 100%);
            border-color: #81c3ff;
        }

        .btn-success {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            border-color: #00b894;
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #00caa3 0%, #00b894 100%);
            border-color: #00caa3;
        }

        /* ==================== Estad√≠sticas ==================== */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
            width: 100%;
            max-width: 400px;
        }

        .stat-item {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-subtle);
            padding: 1.5rem 1rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: 300;
            color: #74b9ff;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* ==================== Configuraciones ==================== */
        .settings {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }

        .settings h3 {
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            font-weight: 500;
            text-align: center;
        }

        .setting-group {
            margin-bottom: 1.5rem;
        }

        .setting-label {
            display: block;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .setting-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-subtle);
            border-radius: 8px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.9);
            color: var(--text-primary);
            transition: border-color 0.3s ease;
        }

        .setting-input:focus {
            outline: none;
            border-color: #74b9ff;
        }

        /* ==================== Responsive ==================== */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .sundial {
                width: 250px;
                height: 250px;
            }
            
            .sundial-base {
                width: 230px;
                height: 230px;
            }
            
            .hour-markers {
                width: 210px;
                height: 210px;
            }
            
            .hour-mark {
                transform-origin: center 105px;
            }
            
            .progress-arc {
                width: 210px;
                height: 210px;
            }
            
            .timer-time {
                font-size: 3rem;
            }
            
            .controls {
                gap: 0.5rem;
            }
            
            .btn {
                padding: 0.75rem 1.5rem;
                min-width: 100px;
            }
        }

        /* ==================== Accesibilidad ==================== */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body class="app work-mode dawn">
    <!-- Header Minimalista -->
    <header class="header">
        <h1>‚òÄÔ∏è Pomodoro Solar</h1>
        <p>T√©cnica de concentraci√≥n siguiendo el ritmo del sol</p>
    </header>

    <!-- Container Principal -->
    <main class="container">
        <!-- Reloj Solar Virtual -->
        <div class="sundial-container">
            <div class="sundial" id="sundial">
                <!-- Base del reloj solar -->
                <div class="sundial-base"></div>
                
                <!-- Marcas horarias -->
                <div class="hour-markers">
                    <div class="hour-mark"></div>
                    <div class="hour-mark"></div>
                    <div class="hour-mark"></div>
                    <div class="hour-mark"></div>
                    <div class="hour-mark"></div>
                    <div class="hour-mark"></div>
                    <div class="hour-mark"></div>
                    <div class="hour-mark"></div>
                    <div class="hour-mark"></div>
                    <div class="hour-mark"></div>
                    <div class="hour-mark"></div>
                    <div class="hour-mark"></div>
                </div>
                
                <!-- Gnomon (puntero central) -->
                <div class="gnomon"></div>
                
                <!-- Sombra del gnomon -->
                <div class="gnomon-shadow" id="gnomonShadow"></div>
                
                <!-- Arco de progreso -->
                <div class="progress-arc" id="progressArc"></div>
            </div>
        </div>

        <!-- Display del Timer -->
        <div class="timer-display">
            <div class="timer-time" id="timerTime">25:00</div>
            <div class="timer-label" id="timerLabel">Sesi√≥n de Trabajo</div>
            <div class="timer-session" id="timerSession">Sesi√≥n 1 de 4</div>
            <div class="day-time-indicator" id="dayTimeIndicator">üåÖ Amanecer Virtual</div>
        </div>

        <!-- Controles -->
        <div class="controls">
            <button class="btn btn-primary" id="startBtn">Iniciar</button>
            <button class="btn" id="pauseBtn">Pausar</button>
            <button class="btn" id="resetBtn">Reiniciar</button>
            <button class="btn" id="settingsBtn">Configurar</button>
        </div>

        <!-- Estad√≠sticas -->
        <div class="stats">
            <div class="stat-item">
                <span class="stat-number" id="completedSessions">0</span>
                <span class="stat-label">Sesiones</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="totalMinutes">0</span>
                <span class="stat-label">Minutos</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="currentStreak">0</span>
                <span class="stat-label">Racha</span>
            </div>
        </div>

        <!-- Configuraciones -->
        <div class="settings" id="settings" style="display: none;">
            <h3>‚öôÔ∏è Configuraci√≥n</h3>
            
            <div class="setting-group">
                <label class="setting-label" for="workDuration">Trabajo (minutos):</label>
                <input type="number" class="setting-input" id="workDuration" value="25" min="1" max="60">
            </div>
            
            <div class="setting-group">
                <label class="setting-label" for="shortBreakDuration">Descanso corto (minutos):</label>
                <input type="number" class="setting-input" id="shortBreakDuration" value="5" min="1" max="30">
            </div>
            
            <div class="setting-group">
                <label class="setting-label" for="longBreakDuration">Descanso largo (minutos):</label>
                <input type="number" class="setting-input" id="longBreakDuration" value="15" min="1" max="60">
            </div>
            
            <div class="controls">
                <button class="btn btn-success" id="saveSettingsBtn">Guardar</button>
                <button class="btn" id="cancelSettingsBtn">Cancelar</button>
            </div>
        </div>
    </main>

    <!-- Screen reader para accesibilidad -->
    <div class="sr-only" aria-live="polite" id="timerAnnouncement"></div>

    <script>
        // ==================== Variables del Timer ==================== 
        let timer = null;
        let timeLeft = 0;
        let isRunning = false;
        let currentMode = 'work'; // 'work', 'shortBreak', 'longBreak'
        let sessionCount = 0;
        let completedSessions = 0;
        let totalMinutes = 0;
        let currentStreak = 0;
        let virtualDay = 0; // Progreso del d√≠a virtual (0-5 para amanecer-noche)

        // Configuraciones por defecto
        let settings = {
            workDuration: 25,
            shortBreakDuration: 5,
            longBreakDuration: 15
        };

        // ==================== Elementos DOM ==================== 
        const elements = {
            timerTime: document.getElementById('timerTime'),
            timerLabel: document.getElementById('timerLabel'),
            timerSession: document.getElementById('timerSession'),
            dayTimeIndicator: document.getElementById('dayTimeIndicator'),
            startBtn: document.getElementById('startBtn'),
            pauseBtn: document.getElementById('pauseBtn'),
            resetBtn: document.getElementById('resetBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            settingsPanel: document.getElementById('settings'),
            saveSettingsBtn: document.getElementById('saveSettingsBtn'),
            cancelSettingsBtn: document.getElementById('cancelSettingsBtn'),
            completedSessionsEl: document.getElementById('completedSessions'),
            totalMinutesEl: document.getElementById('totalMinutes'),
            currentStreakEl: document.getElementById('currentStreak'),
            sundial: document.getElementById('sundial'),
            gnomonShadow: document.getElementById('gnomonShadow'),
            progressArc: document.getElementById('progressArc'),
            app: document.body,
            announcement: document.getElementById('timerAnnouncement')
        };

        // Periodos del d√≠a virtual
        const dayPeriods = [
            { class: 'dawn', name: 'üåÖ Amanecer Virtual', emoji: 'üåÖ' },
            { class: 'morning', name: 'üå§Ô∏è Ma√±ana Virtual', emoji: 'üå§Ô∏è' },
            { class: 'midday', name: '‚òÄÔ∏è Mediod√≠a Virtual', emoji: '‚òÄÔ∏è' },
            { class: 'afternoon', name: 'üåá Tarde Virtual', emoji: 'üåá' },
            { class: 'evening', name: 'üåÜ Atardecer Virtual', emoji: 'üåÜ' },
            { class: 'night', name: 'üåô Noche Virtual', emoji: 'üåô' }
        ];

        // ==================== Funciones del Reloj Solar ==================== 
        function updateSundialShadow() {
            const totalTime = currentMode === 'work' ? settings.workDuration * 60 : 
                             currentMode === 'shortBreak' ? settings.shortBreakDuration * 60 :
                             settings.longBreakDuration * 60;
            
            const progress = (totalTime - timeLeft) / totalTime;
            
            // Calcular √°ngulo de la sombra (360 grados en total)
            const shadowAngle = progress * 360;
            
            // Rotar la sombra del gnomon
            elements.gnomonShadow.style.transform = `translate(-50%, -50%) rotate(${shadowAngle}deg)`;
            
            // Actualizar arco de progreso
            elements.progressArc.style.transform = `translate(-50%, -50%) rotate(${shadowAngle}deg)`;
        }

        function updateVirtualSky() {
            // Cambiar el cielo seg√∫n el n√∫mero de sesiones completadas
            const periodIndex = Math.min(Math.floor(completedSessions / 2), dayPeriods.length - 1);
            const currentPeriod = dayPeriods[periodIndex];
            
            // Remover todas las clases de periodo
            dayPeriods.forEach(period => {
                elements.app.classList.remove(period.class);
            });
            
            // Agregar la clase actual
            elements.app.classList.add(currentPeriod.class);
            
            // Actualizar indicador
            elements.dayTimeIndicator.textContent = currentPeriod.name;
            
            virtualDay = periodIndex;
        }

        function playSolarChime() {
            // Sonido sutil como campanada solar
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // Crear un tono arm√≥nico suave
            const oscillator1 = audioContext.createOscillator();
            const oscillator2 = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator1.connect(gainNode);
            oscillator2.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            // Frecuencias arm√≥nicas (Do y Sol)
            oscillator1.frequency.setValueAtTime(523.25, audioContext.currentTime); // Do5
            oscillator2.frequency.setValueAtTime(783.99, audioContext.currentTime); // Sol5
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1.5);
            
            oscillator1.start(audioContext.currentTime);
            oscillator2.start(audioContext.currentTime);
            oscillator1.stop(audioContext.currentTime + 1.5);
            oscillator2.stop(audioContext.currentTime + 1.5);
        }

        // ==================== Funciones del Timer ==================== 
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateDisplay() {
            elements.timerTime.textContent = formatTime(timeLeft);
            
            // Actualizar etiquetas seg√∫n el modo
            const labels = {
                work: 'Sesi√≥n de Trabajo',
                shortBreak: 'Descanso Corto',
                longBreak: 'Descanso Largo'
            };
            
            elements.timerLabel.textContent = labels[currentMode];
            elements.timerSession.textContent = `Sesi√≥n ${sessionCount + 1} de 4`;
            
            // Actualizar modo visual
            elements.app.className = elements.app.className.replace(/work-mode|break-mode/g, '');
            elements.app.classList.add(currentMode === 'work' ? 'work-mode' : 'break-mode');
            
            // Actualizar sombra del reloj solar
            updateSundialShadow();
            
            // Actualizar cielo virtual
            updateVirtualSky();
        }

        function updateStats() {
            elements.completedSessionsEl.textContent = completedSessions;
            elements.totalMinutesEl.textContent = totalMinutes;
            elements.currentStreakEl.textContent = currentStreak;
        }

        function showNotification(message) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification(message, {
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">‚òÄÔ∏è</text></svg>',
                    tag: 'pomodoro-solar'
                });
            }
            
            // Anuncio para lectores de pantalla
            elements.announcement.textContent = message;
        }

        function startTimer() {
            if (isRunning) return;
            
            isRunning = true;
            elements.startBtn.textContent = 'En marcha...';
            elements.startBtn.disabled = true;
            
            timer = setInterval(() => {
                timeLeft--;
                updateDisplay();
                
                if (timeLeft <= 0) {
                    completeSession();
                }
            }, 1000);
            
            updateDisplay();
        }

        function pauseTimer() {
            if (!isRunning) return;
            
            isRunning = false;
            clearInterval(timer);
            elements.startBtn.textContent = 'Continuar';
            elements.startBtn.disabled = false;
        }

        function resetTimer() {
            isRunning = false;
            clearInterval(timer);
            
            // Resetear a modo trabajo
            currentMode = 'work';
            timeLeft = settings.workDuration * 60;
            
            elements.startBtn.textContent = 'Iniciar';
            elements.startBtn.disabled = false;
            
            updateDisplay();
        }

        function completeSession() {
            isRunning = false;
            clearInterval(timer);
            
            playSolarChime();
            
            // Animaci√≥n de transici√≥n en el reloj solar
            elements.sundial.style.transform = 'scale(1.05)';
            setTimeout(() => {
                elements.sundial.style.transform = 'scale(1)';
            }, 300);
            
            if (currentMode === 'work') {
                completedSessions++;
                sessionCount = (sessionCount + 1) % 4;
                totalMinutes += settings.workDuration;
                currentStreak++;
                
                // Determinar tipo de descanso
                currentMode = sessionCount === 0 ? 'longBreak' : 'shortBreak';
                timeLeft = currentMode === 'longBreak' ? settings.longBreakDuration * 60 : settings.shortBreakDuration * 60;
                
                showNotification('üåÖ ¬°Sesi√≥n completada! El sol avanza en el cielo.');
            } else {
                // Completar descanso
                currentMode = 'work';
                timeLeft = settings.workDuration * 60;
                
                showNotification('‚òÄÔ∏è ¬°Descanso terminado! El sol contin√∫a su camino.');
            }
            
            elements.startBtn.textContent = 'Iniciar';
            elements.startBtn.disabled = false;
            
            updateDisplay();
            updateStats();
        }

        // ==================== Configuraciones ==================== 
        function showSettings() {
            elements.settingsPanel.style.display = 'block';
            
            // Cargar valores actuales
            document.getElementById('workDuration').value = settings.workDuration;
            document.getElementById('shortBreakDuration').value = settings.shortBreakDuration;
            document.getElementById('longBreakDuration').value = settings.longBreakDuration;
        }

        function hideSettings() {
            elements.settingsPanel.style.display = 'none';
        }

        function saveSettings() {
            settings.workDuration = parseInt(document.getElementById('workDuration').value);
            settings.shortBreakDuration = parseInt(document.getElementById('shortBreakDuration').value);
            settings.longBreakDuration = parseInt(document.getElementById('longBreakDuration').value);
            
            // Guardar en localStorage
            localStorage.setItem('pomodoroSolarSettings', JSON.stringify(settings));
            
            // Resetear timer con nueva configuraci√≥n
            resetTimer();
            hideSettings();
        }

        function loadSettings() {
            const saved = localStorage.getItem('pomodoroSolarSettings');
            if (saved) {
                settings = JSON.parse(saved);
            }
            
            const savedStats = localStorage.getItem('pomodoroSolarStats');
            if (savedStats) {
                const stats = JSON.parse(savedStats);
                completedSessions = stats.completedSessions || 0;
                totalMinutes = stats.totalMinutes || 0;
                currentStreak = stats.currentStreak || 0;
            }
        }

        function saveStats() {
            const stats = {
                completedSessions,
                totalMinutes,
                currentStreak
            };
            localStorage.setItem('pomodoroSolarStats', JSON.stringify(stats));
        }

        // ==================== Event Listeners ==================== 
        elements.startBtn.addEventListener('click', startTimer);
        elements.pauseBtn.addEventListener('click', pauseTimer);
        elements.resetBtn.addEventListener('click', resetTimer);
        elements.settingsBtn.addEventListener('click', showSettings);
        elements.saveSettingsBtn.addEventListener('click', saveSettings);
        elements.cancelSettingsBtn.addEventListener('click', hideSettings);

        // Pedir permisos de notificaci√≥n
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        // Guardar estad√≠sticas autom√°ticamente
        window.addEventListener('beforeunload', saveStats);

        // Prevenir que la p√°gina se cierre accidentalmente durante sesi√≥n activa
        window.addEventListener('beforeunload', (e) => {
            if (isRunning) {
                e.preventDefault();
                e.returnValue = '¬øEst√°s seguro de que quieres salir? El reloj solar se detendr√°.';
            }
        });

        // ==================== Inicializaci√≥n ==================== 
        loadSettings();
        timeLeft = settings.workDuration * 60;
        updateDisplay();
        updateStats();

        // Animaci√≥n inicial suave del reloj solar
        setTimeout(() => {
            elements.sundial.style.transition = 'transform 0.3s ease';
            updateSundialShadow();
        }, 500);
    </script>
</body>
</html>