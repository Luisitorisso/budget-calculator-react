/**
 * Definiciones de todos los logros/achievements del sistema de gamificaciÃ³n
 * Cada logro tiene: id, nombre, descripciÃ³n, icono, condiciÃ³n de desbloqueo, puntos
 */

export const ACHIEVEMENT_CATEGORIES = {
  BEGINNER: 'beginner',
  TRANSACTIONS: 'transactions',
  SAVINGS: 'savings',
  GOALS: 'goals',
  STREAK: 'streak',
  ADVANCED: 'advanced',
};

export const ACHIEVEMENTS = {
  // LOGROS DE PRINCIPIANTE
  FIRST_INCOME: {
    id: 'first_income',
    name: 'Primer Ingreso',
    description: 'Registra tu primer ingreso',
    icon: 'ðŸ’°',
    category: ACHIEVEMENT_CATEGORIES.BEGINNER,
    points: 10,
    condition: (stats) => stats.totalIncomes >= 1,
  },
  
  FIRST_EXPENSE: {
    id: 'first_expense',
    name: 'Primer Gasto',
    description: 'Registra tu primer gasto',
    icon: 'ðŸ’¸',
    category: ACHIEVEMENT_CATEGORIES.BEGINNER,
    points: 10,
    condition: (stats) => stats.totalExpenses >= 1,
  },

  FIRST_GOAL: {
    id: 'first_goal',
    name: 'SoÃ±ador',
    description: 'Crea tu primera meta financiera',
    icon: 'ðŸŽ¯',
    category: ACHIEVEMENT_CATEGORIES.BEGINNER,
    points: 15,
    condition: (stats) => stats.totalGoals >= 1,
  },

  DARK_MODE: {
    id: 'dark_mode',
    name: 'Modo Nocturno',
    description: 'Activa el modo oscuro',
    icon: 'ðŸŒ™',
    category: ACHIEVEMENT_CATEGORIES.BEGINNER,
    points: 5,
    condition: (stats) => stats.usedDarkMode === true,
  },

  // LOGROS DE TRANSACCIONES
  TRANSACTION_10: {
    id: 'transaction_10',
    name: 'Disciplinado',
    description: 'Registra 10 transacciones',
    icon: 'ðŸ“',
    category: ACHIEVEMENT_CATEGORIES.TRANSACTIONS,
    points: 20,
    condition: (stats) => (stats.totalIncomes + stats.totalExpenses) >= 10,
  },

  TRANSACTION_50: {
    id: 'transaction_50',
    name: 'Detallista',
    description: 'Registra 50 transacciones',
    icon: 'ðŸ“Š',
    category: ACHIEVEMENT_CATEGORIES.TRANSACTIONS,
    points: 50,
    condition: (stats) => (stats.totalIncomes + stats.totalExpenses) >= 50,
  },

  TRANSACTION_100: {
    id: 'transaction_100',
    name: 'Contador Profesional',
    description: 'Registra 100 transacciones',
    icon: 'ðŸ†',
    category: ACHIEVEMENT_CATEGORIES.TRANSACTIONS,
    points: 100,
    condition: (stats) => (stats.totalIncomes + stats.totalExpenses) >= 100,
  },

  // LOGROS DE AHORRO
  POSITIVE_BALANCE: {
    id: 'positive_balance',
    name: 'En Verde',
    description: 'MantÃ©n un balance positivo',
    icon: 'âœ…',
    category: ACHIEVEMENT_CATEGORIES.SAVINGS,
    points: 25,
    condition: (stats) => stats.currentBalance > 0,
  },

  SAVINGS_1000: {
    id: 'savings_1000',
    name: 'Ahorrista Novato',
    description: 'Alcanza $1,000 en ahorros',
    icon: 'ðŸ’µ',
    category: ACHIEVEMENT_CATEGORIES.SAVINGS,
    points: 30,
    condition: (stats) => stats.currentBalance >= 1000,
  },

  SAVINGS_5000: {
    id: 'savings_5000',
    name: 'Ahorrista Intermedio',
    description: 'Alcanza $5,000 en ahorros',
    icon: 'ðŸ’Ž',
    category: ACHIEVEMENT_CATEGORIES.SAVINGS,
    points: 75,
    condition: (stats) => stats.currentBalance >= 5000,
  },

  SAVINGS_10000: {
    id: 'savings_10000',
    name: 'Maestro del Ahorro',
    description: 'Alcanza $10,000 en ahorros',
    icon: 'ðŸ‘‘',
    category: ACHIEVEMENT_CATEGORIES.SAVINGS,
    points: 150,
    condition: (stats) => stats.currentBalance >= 10000,
  },

  // LOGROS DE METAS
  GOAL_COMPLETED: {
    id: 'goal_completed',
    name: 'Objetivo Cumplido',
    description: 'Completa tu primera meta',
    icon: 'ðŸŽ‰',
    category: ACHIEVEMENT_CATEGORIES.GOALS,
    points: 50,
    condition: (stats) => stats.goalsCompleted >= 1,
  },

  GOAL_3_COMPLETED: {
    id: 'goal_3_completed',
    name: 'Triatleta Financiero',
    description: 'Completa 3 metas',
    icon: 'ðŸ…',
    category: ACHIEVEMENT_CATEGORIES.GOALS,
    points: 100,
    condition: (stats) => stats.goalsCompleted >= 3,
  },

  GOAL_ON_TRACK: {
    id: 'goal_on_track',
    name: 'Bien Encaminado',
    description: 'MantÃ©n una meta on-track durante 7 dÃ­as',
    icon: 'ðŸ“ˆ',
    category: ACHIEVEMENT_CATEGORIES.GOALS,
    points: 40,
    condition: (stats) => stats.goalsOnTrackDays >= 7,
  },

  // LOGROS DE RACHA
  STREAK_3: {
    id: 'streak_3',
    name: 'Constante',
    description: 'Registra transacciones 3 dÃ­as seguidos',
    icon: 'ðŸ”¥',
    category: ACHIEVEMENT_CATEGORIES.STREAK,
    points: 20,
    condition: (stats) => stats.currentStreak >= 3,
  },

  STREAK_7: {
    id: 'streak_7',
    name: 'Semana Perfecta',
    description: 'Registra transacciones 7 dÃ­as seguidos',
    icon: 'â­',
    category: ACHIEVEMENT_CATEGORIES.STREAK,
    points: 50,
    condition: (stats) => stats.currentStreak >= 7,
  },

  STREAK_30: {
    id: 'streak_30',
    name: 'Mes Imparable',
    description: 'Registra transacciones 30 dÃ­as seguidos',
    icon: 'ðŸ’«',
    category: ACHIEVEMENT_CATEGORIES.STREAK,
    points: 150,
    condition: (stats) => stats.currentStreak >= 30,
  },

  // LOGROS AVANZADOS
  EXPORT_DATA: {
    id: 'export_data',
    name: 'Archivista',
    description: 'Exporta tus datos por primera vez',
    icon: 'ðŸ“¥',
    category: ACHIEVEMENT_CATEGORIES.ADVANCED,
    points: 15,
    condition: (stats) => stats.dataExported === true,
  },

  AI_INSIGHTS: {
    id: 'ai_insights',
    name: 'Analista IA',
    description: 'Usa las predicciones de IA',
    icon: 'ðŸ¤–',
    category: ACHIEVEMENT_CATEGORIES.ADVANCED,
    points: 25,
    condition: (stats) => stats.usedAI === true,
  },

  CREDIT_CARD_MANAGER: {
    id: 'credit_card_manager',
    name: 'Gestor de CrÃ©dito',
    description: 'Agrega una tarjeta de crÃ©dito',
    icon: 'ðŸ’³',
    category: ACHIEVEMENT_CATEGORIES.ADVANCED,
    points: 20,
    condition: (stats) => stats.creditCardsAdded >= 1,
  },

  BUDGET_MASTER: {
    id: 'budget_master',
    name: 'Maestro del Presupuesto',
    description: 'Desbloquea todos los logros bÃ¡sicos',
    icon: 'ðŸ†',
    category: ACHIEVEMENT_CATEGORIES.ADVANCED,
    points: 200,
    condition: (stats) => stats.achievementsUnlocked >= 15,
  },
};

/**
 * Obtiene todos los logros como array
 */
export const getAllAchievements = () => {
  return Object.values(ACHIEVEMENTS);
};

/**
 * Calcula el nivel del usuario basado en puntos totales
 */
export const calculateLevel = (totalPoints) => {
  if (totalPoints < 50) return 1;
  if (totalPoints < 150) return 2;
  if (totalPoints < 300) return 3;
  if (totalPoints < 500) return 4;
  if (totalPoints < 750) return 5;
  if (totalPoints < 1000) return 6;
  if (totalPoints < 1500) return 7;
  if (totalPoints < 2000) return 8;
  if (totalPoints < 3000) return 9;
  return 10;
};

/**
 * Calcula puntos necesarios para el siguiente nivel
 */
export const getPointsForNextLevel = (totalPoints) => {
  const thresholds = [50, 150, 300, 500, 750, 1000, 1500, 2000, 3000];
  const nextThreshold = thresholds.find(t => t > totalPoints);
  return nextThreshold || 3000;
};

/**
 * Calcula el progreso hacia el siguiente nivel (0-100)
 */
export const getLevelProgress = (totalPoints) => {
  const currentLevel = calculateLevel(totalPoints);
  if (currentLevel === 10) return 100;
  
  const thresholds = [0, 50, 150, 300, 500, 750, 1000, 1500, 2000, 3000];
  const currentThreshold = thresholds[currentLevel - 1];
  const nextThreshold = thresholds[currentLevel];
  
  const progress = ((totalPoints - currentThreshold) / (nextThreshold - currentThreshold)) * 100;
  return Math.min(100, Math.max(0, progress));
};
